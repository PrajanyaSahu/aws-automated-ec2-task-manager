<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AWS Task Manager</title>
  </head>
  <body>
    <h1>Task Manager</h1>

    <input id="title" placeholder="New task" />
    <button id="add">Add Task</button>
    <button id="load">Load Tasks</button>

    <h2>Tasks</h2>
    <ul id="list"></ul>

    <pre id="debug"></pre>

    <script>
      // IMPORTANT: this must point to the backend on port 3000
      const API_BASE = "http://localhost:3000";

      function log(msg) {
        const dbg = document.getElementById("debug");
        dbg.textContent += msg + "\n";
      }

      async function loadTasks() {
        log("Loading tasks...");
        try {
          const res = await fetch(API_BASE + "/api/tasks");
          log("Status: " + res.status);
          const tasks = await res.json();
          const ul = document.getElementById("list");
          ul.innerHTML = "";
          tasks.forEach(t => {
            const li = document.createElement("li");
            li.textContent = t.title + (t.completed ? " (done)" : "");
            ul.appendChild(li);
          });
          log("Loaded " + tasks.length + " tasks.");
        } catch (e) {
          log("Error loading tasks: " + e);
        }
      }

      document.getElementById("load").onclick = loadTasks;

      document.getElementById("add").onclick = async () => {
        const input = document.getElementById("title");
        const title = input.value.trim();
        if (!title) {
          log("No title entered");
          return;
        }
        log("Adding task: " + title);
        try {
          const res = await fetch(API_BASE + "/api/tasks", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title })
          });
          log("Add status: " + res.status);
          input.value = "";
          await loadTasks();
        } catch (e) {
          log("Error adding task: " + e);
        }
      };
    </script>
  </body>
</html>
